<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLB九局職棒 球員能力值</title>
    <style>
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            /* 移除或註解掉 min-height: 100vh;  如果需要縮減整體網頁高度 */
            margin: 0;
            font-size: 1em; /* **再次加大網頁基礎字體大小** */
        }

        .container {
            background-color: #1e1e1e;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            width: fit-content;
            max-width: 600px;
            margin: 20px;
        }

        h2 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .filters {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            align-items: center;
        }

        .filters label {
            font-size: 0.9em;
        }

        .filters select, .filters input, .filters button {
            background-color: #333;
            color: #ffffff;
            border: 1px solid #555;
            padding: 6px;
            border-radius: 5px;
            font-size: 0.85em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8em;
        }

        th, td {
            border: 1px solid #555;
            padding: 6px; /* **維持水平 padding，垂直 padding 縮減** */
            padding-top: 4px;
            padding-bottom: 4px;
            text-align: center;
            word-break: break-word;
            width: auto;
        }


        th {
            background-color: #333;
            font-weight: bold;
        }

        tr:nth-child(odd) {
            background-color: #2a2a2a;
        }

        tr:nth-child(even) {
            background-color: #1e1e1e;
        }

        input[type="checkbox"] {
            width: 12px;
            height: 12px;
        }

        select {
            background-color: #333;
            color: #ffffff;
            border: 1px solid #555;
            padding: 6px;
            border-radius: 5px;
            font-size: 0.85em;
        }

        .blank-row td {
            border: none;
            background-color: transparent;
            padding: 3px 0;
        }

        .average-value {
            font-weight: bold;
        }

        input[type="number"] {
            width: 100%;
            box-sizing: border-box;
            padding: 5px;
            font-size: 0.85em;
            border: 1px solid #555;
            background-color: #333;
            color: #ffffff;
            border-radius: 5px;
            margin: 0;
            text-align: left; /* **移除數字置中效果，改為靠左對齊** */
        }

        .filters input {
            width: auto;
            box-sizing: border-box;
        }

        .number-font {
            font-size: 0.85em;
        }

        #player-input,
        #player-select {
            width: 150px; /* 設定固定的寬度，您可以根據需要調整數值 */
            box-sizing: border-box; /* 確保 padding 和 border 包含在 width 內 */
        }

    </style>
</head>
<body>
    <div class="container">
        <h2>MLB九局職棒 球員能力值</h2>

        <div class="filters">
            <button id="clear-all-button" type="button">清除所有</button>
            <label for="type">類型:</label>
            <select id="type" name="type">
                <option value="">-- 請選擇 --</option>
                <option value="general">一般</option>
                <option value="classic">經典</option>
                <option value="signature">簽名</option>
                <option value="legend">傳說</option>
                <option value="epic">史詩</option>
                <option value="prime">全盛</option>
            </select>
        
            <label for="team">球隊:</label>
            <select id="team" name="team">
                <option value="">-- 請選擇 --</option>
                <option value="NYY">NYY</option>
                <option value="OAK">OAK</option>
                <option value="HOU">HOU</option>
                <option value="WSH">WSH</option>
                <option value="STL">STL</option>
                <option value="LAD">LAD</option>
            </select>
        </div>

        <table>
            <thead>
                <tr>
                    <th colspan="2">位置</th>
                    <th colspan="5">球員</th>
                    <th>階級</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="2">
                        <select id="position" name="position">
                            <option value="">-- 請選擇位置 --</option>
                            <optgroup label="打者">
                                <option value="C">C</option>
                                <option value="1B">1B</option>
                                <option value="2B">2B</option>
                                <option value="3B">3B</option>
                                <option value="SS">SS</option>
                                <option value="OF">OF</option>
                                <option value="DH">DH</option>
                            </optgroup>
                            <optgroup label="投手">
                                <option value="SP">SP</option>
                                <option value="RP">RP</option>
                                <option value="CP">CP</option>
                            </optgroup>
                        </select>
                    </td>
                    <td colspan="5">
                        <input type="text" id="player-input" placeholder="自行輸入球員">
                        <select id="player-select" name="player-select">
                            <option value="">-- 或選擇球員 --</option>
                        </select>
                    </td>
                    <td>
                        <select id="tier" name="tier">
                            <option value="白金">白金</option>
                            <option value="黑鑽">黑鑽</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>項目</td>
                    <td class="number-font">接觸</td>
                    <td class="number-font">力量</td>
                    <td class="number-font">選球</td>
                    <td class="number-font">速度</td>
                    <td class="number-font">守備</td>
                    <td class="number-font">值</td>
                </tr>
                <tr>
                    <td colspan="2">基本能力值</td>
                    <td><input type="number" value="0" id="base-skill1" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="base-skill2" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="base-skill3" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="base-skill4" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="base-skill5" class="average-value number-font"></td>
                    <td id="base-average" class="average-value number-font"></td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>基本校正</td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="2">階級上升量</td>
                    <td><input type="number" value="0" id="tier-skill1" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="tier-skill2" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="tier-skill3" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="tier-skill4" class="average-value number-font"></td>
                    <td><input type="number" value="0" id="tier-skill5" class="average-value number-font"></td>
                    <td id="tier-sum" class="average-value number-font"></td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>強化量</td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td id="enhance-sum" class="average-value number-font"></td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>教練</td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td id="coach-sum" class="average-value number-font"></td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>特別訓練</td>
                    <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td>
                        <select class="number-font">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select> </td>
                </tr>
                <tr id="coaching-player-row">
                    <td><input type="checkbox" checked></td>
                    <td>指導球員</td>
                    <td><input type="number" class="same-as-dropdown number-font" value="0"></td> <td><input type="number" class="same-as-dropdown number-font" value="0"></td> <td><input type="number" class="same-as-dropdown number-font" value="0"></td> <td><input type="number" class="same-as-dropdown number-font" value="0"></td> <td><input type="number" class="same-as-dropdown number-font" value="0"></td> <td>
                        <select id="coaching-player-select" class="number-font">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select> </td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>黑鑽</td>
                    <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td id="black-diamond-sum" class="average-value number-font"></td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>團隊加成</td>
                    <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td></td>
                </tr>
                <tr>
                    <td colspan="2">一般陣容能力值</td>
                    <td id="roster-skill1" class="average-value number-font"></td>
                    <td id="roster-skill2" class="average-value number-font"></td>
                    <td id="roster-skill3" class="average-value number-font"></td>
                    <td id="roster-skill4" class="average-value number-font"></td>
                    <td id="roster-skill5" class="average-value number-font"></td>
                    <td id="roster-average" class="average-value number-font"></td>
                </tr>
                <tr class="blank-row"><td colspan="8"></td></tr>
                <tr id="status-row">
                    <td><input type="checkbox" checked></td>
                    <td>狀態</td>
                    <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td><input type="number" value="0" class="number-font"></td> <td>
                        <select id="status-select" class="number-font"> <option value="-3">-3</option>
                            <option value="0" selected>0</option>
                            <option value="3">3</option>
                            <option value="6">6</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>裝備</td>
                     <td><input type="number" class="number-font" value="0"></td> <td><input type="number" class="number-font" value="0"></td> <td><input type="number" class="number-font" value="0"></td> <td><input type="number" class="number-font" value="0"></td> <td><input type="number" class="number-font" value="0"></td> <td>
                        <select class="number-font">
                            <option value="無">無</option>
                            <option value="銅">銅</option>
                            <option value="銀">銀</option>
                            <option value="金">金</option>
                            <option value="白">白</option>
                        </select> </td>
                </tr>
                <tr>
                    <td><input type="checkbox" checked></td>
                    <td>技能</td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td><input type="number" value="0" class="number-font"></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="2">上場能力值</td>
                    <td id="on-field-skill1" class="average-value number-font"></td>
                    <td id="on-field-skill2" class="average-value number-font"></td>
                    <td id="on-field-skill3" class="average-value number-font"></td>
                    <td id="on-field-skill4" class="average-value number-font"></td>
                    <td id="on-field-skill5" class="average-value number-font"></td>
                    <td id="on-field-average" class="average-value number-font"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // 1. 取得 DOM 元素 (使用更通用的變數名稱 statCategory + 索引)
        const clearAllButton = document.getElementById('clear-all-button');
        const typeSelect = document.getElementById('type');
        const teamSelect = document.getElementById('team');
        const positionSelect = document.getElementById('position');
        const playerSelect = document.getElementById('player-select');
        const playerInput = document.getElementById('player-input');
        const tierSelect = document.getElementById('tier');
    
        const statCategoryHeaderRow = document.querySelectorAll('thead tr')[1]; // 項目名稱列
        const statCategoryHeaderCells = statCategoryHeaderRow.querySelectorAll('th:nth-child(n+3):nth-child(-n+7)'); // 項目名稱儲存格 (接觸, 力量...)
    
        const baseStatCategoryInput = Array.from({ length: 5 }, (_, i) => document.getElementById(`base-skill${i + 1}`)); // 基本能力值輸入框
        const tierStatCategoryInput = Array.from({ length: 5 }, (_, i) => document.getElementById(`tier-skill${i + 1}`)); // 階級上升量輸入框
        const enhanceStatCategoryInput = Array.from(document.querySelectorAll('#enhance-row input[type="number"]')); // 強化量輸入框 (假設強化量在沒有 id 的情況下用 querySelectorAll)
        const coachStatCategoryInput = Array.from(document.querySelectorAll('#coach-row input[type="number"]')); // 教練輸入框 (假設教練在沒有 id 的情況下用 querySelectorAll)
        const specialTrainingSelect = document.querySelector('#special-training-row select'); // 特別訓練下拉選單 (假設特別訓練的 <tr> 有 id)
        const coachingPlayerSelect = document.getElementById('coaching-player-select'); // 指導球員下拉選單
        const blackDiamondStatCategoryInput = Array.from(document.querySelectorAll('#black-diamond-row input[type="number"]')); // 黑鑽輸入框 (假設黑鑽在沒有 id 的情況下用 querySelectorAll)
        const teamBuffStatCategoryInput = Array.from(document.querySelectorAll('#team-buff-row input[type="number"]')); // 團隊加成輸入框 (假設團隊加成在沒有 id 的情況下用 querySelectorAll)
        const statusSelect = document.getElementById('status-select'); // 狀態下拉選單
        const equipmentSelect = document.querySelector('#equipment-row select'); // 裝備下拉選單 (假設裝備的 <tr> 有 id)
        const skillStatCategoryInput = Array.from(document.querySelectorAll('#skill-row input[type="number"]')); // 技能輸入框 (假設技能在沒有 id 的情況下用 querySelectorAll)
    
    
        const baseAverageElement = document.getElementById('base-average'); // 基本能力值平均值顯示
        const tierSumElement = document.getElementById('tier-sum'); // 階級上升量總和顯示
        const enhanceSumElement = document.getElementById('enhance-sum'); // 強化量總和顯示
        const coachSumElement = document.getElementById('coach-sum'); // 教練總和顯示
        const blackDiamondSumElement = document.getElementById('black-diamond-sum'); // 黑鑽總和顯示
    
    
        const rosterStatCategoryElement = Array.from({ length: 5 }, (_, i) => document.getElementById(`roster-skill${i + 1}`)); // 一般陣容能力值顯示
        const rosterAverageElement = document.getElementById('roster-average'); // 一般陣容能力值平均值顯示
    
        const onFieldStatCategoryElement = Array.from({ length: 5 }, (_, i) => document.getElementById(`on-field-skill${i + 1}`)); // 上場能力值顯示
        const onFieldAverageElement = document.getElementById('on-field-average'); // 上場能力值平均值顯示
    
    
        // 2. 資料載入 (loadPlayerData 函數 - 假設 data.json 結構不變)
        let playerData = [];
        loadPlayerData();
    
        // 3. 篩選器與下拉選單更新 (updatePlayerDropdown, populateTable 函數)
        updatePlayerDropdown();
    
    
        // 4. 事件監聽器
        typeSelect.addEventListener('change', updatePlayerDropdown);
        teamSelect.addEventListener('change', updatePlayerDropdown);
        positionSelect.addEventListener('change', () => {
            updatePlayerDropdown();
            updateStatCategoryHeaders(); // 更新表頭文字
            clearTableValues(); // 清除表格數值當位置改變時 (可選)
        });
        playerSelect.addEventListener('change', populateTable);
        clearAllButton.addEventListener('click', clearAll);
    
    
        // 能力值輸入框的事件監聽器 (迴圈處理，使用通用的變數名稱)
        baseStatCategoryInput.forEach(input => input.addEventListener('change', updateBaseAverage));
        tierStatCategoryInput.forEach(input => input.addEventListener('change', updateTierSum));
        enhanceStatCategoryInput.forEach(input => input.addEventListener('change', updateEnhanceSum));
        coachStatCategoryInput.forEach(input => input.addEventListener('change', updateCoachSum));
        blackDiamondStatCategoryInput.forEach(input => input.addEventListener('change', updateBlackDiamondSum));
    
    
        // 指導球員與狀態下拉選單的事件監聽器
        coachingPlayerSelect.addEventListener('change', updateCoachingPlayerValues);
        statusSelect.addEventListener('change', updateStatusValues);
    
    
        // 5. 計算函數 (updateBaseAverage, updateTierSum, ..., updateRosterValues, updateOnFieldValues)
        function updateBaseAverage() {
            let sum = baseStatCategoryInput.reduce((acc, input) => acc + parseInt(input.value || 0), 0);
            baseAverageElement.textContent = (sum / 5).toFixed(1);
        }
    
        function updateTierSum() {
            let sum = tierStatCategoryInput.reduce((acc, input) => acc + parseInt(input.value || 0), 0);
            tierSumElement.textContent = sum;
        }
    
        function updateEnhanceSum() { // 強化量總和計算
            let sum = enhanceStatCategoryInput.reduce((acc, input) => acc + parseInt(input.value || 0), 0);
            enhanceSumElement.textContent = sum;
        }
    
        function updateCoachSum() { // 教練總和計算
            let sum = coachStatCategoryInput.reduce((acc, input) => acc + parseInt(input.value || 0), 0);
            coachSumElement.textContent = sum;
        }
    
        function updateBlackDiamondSum() { // 黑鑽總和計算
            let sum = blackDiamondStatCategoryInput.reduce((acc, input) => acc + parseInt(input.value || 0), 0);
            blackDiamondSumElement.textContent = sum;
        }
    
    
        function updateRosterValues() { // 一般陣容能力值計算 (需要完成)
            // 取得所有相關的輸入值 (基本, 階級, 強化, 教練, 特別訓練, 指導球員, 黑鑽, 團隊加成)
            // 將它們加總，並更新 rosterStatCategoryElement 和 rosterAverageElement
            // ... (待完成) ...
            // 示例：
            for (let i = 0; i < 5; i++) {
                let baseValue = parseInt(baseStatCategoryInput[i].value) || 0;
                let tierValue = parseInt(tierStatCategoryInput[i].value) || 0;
                let enhanceValue = parseInt(enhanceStatCategoryInput[i].value) || 0;
                let coachValue = parseInt(coachStatCategoryInput[i].value) || 0;
                let specialTrainingValue = parseInt(specialTrainingSelect.value) || 0; // 假設特別訓練 select value 是數值
                let coachingPlayerValue = parseInt(coachingPlayerSelect.value) || 0; // 假設指導球員 select value 是數值
                let blackDiamondValue = parseInt(blackDiamondStatCategoryInput[i].value) || 0;
                let teamBuffValue = parseInt(teamBuffStatCategoryInput[i].value) || 0;
    
                let rosterValue = baseValue + tierValue + enhanceValue + coachValue + specialTrainingValue + coachingPlayerValue + blackDiamondValue + teamBuffValue;
                rosterStatCategoryElement[i].textContent = rosterValue;
            }
            updateRosterAverage(); // 更新平均值
        }
    
        function updateRosterAverage() { // 一般陣容能力值平均值計算
            let sum = rosterStatCategoryElement.reduce((acc, element) => acc + parseInt(element.textContent || 0), 0);
            rosterAverageElement.textContent = (sum / 5).toFixed(1);
        }
    
    
        function updateOnFieldValues() { // 上場能力值計算 (需要完成)
            // 在 updateRosterValues 的基礎上，加入狀態、裝備、技能的加成
            // 將它們加總，並更新 onFieldStatCategoryElement 和 onFieldAverageElement
            // ... (待完成) ...
            // 示例 (假設狀態和裝備也影響所有能力值):
            for (let i = 0; i < 5; i++) {
                let rosterValue = parseInt(rosterStatCategoryElement[i].textContent) || 0;
                let statusValue = parseInt(statusSelect.value) || 0;
                let equipmentValue = parseInt(equipmentSelect.value) || 0; // 假設裝備 select value 是數值或需要轉換
                let skillValue = parseInt(skillStatCategoryInput[i].value) || 0;
    
                let onFieldValue = rosterValue + statusValue + equipmentValue + skillValue;
                onFieldStatCategoryElement[i].textContent = onFieldValue;
            }
            updateOnFieldAverage(); // 更新平均值
        }
    
        function updateOnFieldAverage() { // 上場能力值平均值計算
            let sum = onFieldStatCategoryElement.reduce((acc, element) => acc + parseInt(element.textContent || 0), 0);
            onFieldAverageElement.textContent = (sum / 5).toFixed(1);
        }
    
    
        function updateStatCategoryHeaders() {
            const selectedPosition = positionSelect.value;
            let headers = [];
            if (['C', '1B', '2B', '3B', 'SS', 'OF', 'DH'].includes(selectedPosition)) {
                headers = ['接觸', '力量', '選球', '速度', '守備'];
            } else if (['SP', 'RP', 'CP'].includes(selectedPosition)) {
                headers = ['控球', '球威', '體力', '直球', '變化'];
            } else {
                headers = ['項目1', '項目2', '項目3', '項目4', '項目5']; // 預設值或空值
            }
            statCategoryHeaderCells.forEach((cell, index) => {
                cell.textContent = headers[index];
            });
        }
    
    
        function updatePlayerDropdown() {
            const selectedType = typeSelect.value;
            const selectedTeam = teamSelect.value;
            const selectedPosition = positionSelect.value;
    
            playerSelect.innerHTML = '<option value="">-- 或選擇球員 --</option>'; // 清空選項
    
            if (!selectedType || !selectedTeam || !selectedPosition) {
                return; // 如果篩選條件不完整，則不更新球員下拉選單
            }
    
            const filteredPlayers = playerData.filter(player => {
                return player.types[selectedType] && player.team === selectedTeam && player.position === selectedPosition;
            });
    
            // 根據球員名稱繁體中文排序
            filteredPlayers.sort((a, b) => a.name.localeCompare(b.name, 'zh-TW'));
    
    
            filteredPlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player.name;
                option.textContent = `${player.name} (${player.team})`; // 顯示球員名稱和球隊代碼
                playerSelect.appendChild(option);
            });
        }
    
    
        function populateTable() {
            const selectedPlayerName = playerSelect.value;
    
            if (!selectedPlayerName) {
                clearTableValues(); // 清空表格數值
                return;
            }
    
    
            const selectedPlayer = playerData.find(player => player.name === selectedPlayerName);
    
            if (selectedPlayer) {
                // 自動填入球隊和位置篩選器 (可選，如果需要的話)
                teamSelect.value = selectedPlayer.team;
                positionSelect.value = selectedPlayer.position;
                typeSelect.value = 'general'; // 預設類型為 general，或者根據球員資料設定
    
                playerInput.value = selectedPlayer.name; // 球員名稱填入輸入框
    
    
                // 填入基本能力值和階級上升量 (假設都只有 general type 的數值)
                for (let i = 0; i < 5; i++) {
                    const skillNames = ['contact', 'power', 'eye', 'speed', 'fielding']; // 假設 data.json 還是用英文 skill names
                    baseStatCategoryInput[i].value = selectedPlayer.types['general'].base_state[skillNames[i]] || 0; // 預設值為 0
                    tierStatCategoryInput[i].value = selectedPlayer.types['general'].tier_increase[skillNames[i]] || 0; // 預設值為 0
                }
                updateBaseAverage(); // 更新基本能力值平均
                updateTierSum(); // 更新階級上升量總和
                updateStatCategoryHeaders(); // 確保表頭正確 (雖然 populateTable 應該在 position change 之後，再次調用確保一致)
                updateRosterValues(); // 重新計算一般陣容能力值
                updateOnFieldValues(); // 重新計算上場能力值
    
            } else {
                clearTableValues(); // 清空表格數值，如果找不到球員資料
            }
        }
    
    
        function clearTableValues() { // 清空表格數值函數
            baseStatCategoryInput.forEach(input => input.value = 0);
            tierStatCategoryInput.forEach(input => input.value = 0);
            enhanceStatCategoryInput.forEach(input => input.value = 0);
            coachStatCategoryInput.forEach(input => input.value = 0);
            specialTrainingSelect.value = 0;
            coachingPlayerSelect.value = 0;
            blackDiamondStatCategoryInput.forEach(input => input.value = 0);
            teamBuffStatCategoryInput.forEach(input => input.value = 0);
            statusSelect.value = 0;
            equipmentSelect.value = '無';
            skillStatCategoryInput.forEach(input => input.value = 0);
    
            baseAverageElement.textContent = '';
            tierSumElement.textContent = '';
            enhanceSumElement.textContent = '';
            coachSumElement.textContent = '';
            blackDiamondSumElement.textContent = '';
            rosterStatCategoryElement.forEach(element => element.textContent = '');
            rosterAverageElement.textContent = '';
            onFieldStatCategoryElement.forEach(element => element.textContent = '');
            onFieldAverageElement.textContent = '';
        }
    
    
        function updateCoachingPlayerValues() {
            const selectedValue = coachingPlayerSelect.value;
            const inputsToUpdate = document.querySelectorAll('#coaching-player-row input.same-as-dropdown[type="number"]');
            inputsToUpdate.forEach(input => {
                input.value = selectedValue;
            });
            updateRosterValues(); // 更新一般陣容能力值
            updateOnFieldValues(); // 更新上場能力值
        }
    
        function updateStatusValues() {
            const selectedValue = statusSelect.value;
            const inputsToUpdate = document.querySelectorAll('#status-row input[type="number"]');
            inputsToUpdate.forEach(input => {
                input.value = selectedValue;
            });
            updateRosterValues(); // 更新一般陣容能力值
            updateOnFieldValues(); // 更新上場能力值
        }
    
    
        function clearAll() {
            typeSelect.value = '';
            teamSelect.value = '';
            positionSelect.value = '';
            playerSelect.value = '';
            playerInput.value = '';
            clearTableValues();
            updatePlayerDropdown(); // 清空球員下拉選單選項
            updateStatCategoryHeaders(); // 重設表頭為預設值 (或清空)
        }
    
    
        // 初始呼叫 (可以放在函數定義之後)
        updateStatCategoryHeaders(); // 網頁載入時設定初始表頭 (預設打者)
        updateRosterValues(); // 初始化一般陣容能力值 (可選)
        updateOnFieldValues(); // 初始化上場能力值 (可選)
    
    
    });
    
    
    // 載入球員資料 (loadPlayerData 函數 - 假設 data.json 路徑不變)
    function loadPlayerData() {
        fetch('data.json') // 假設 data.json 檔案在同一個目錄下
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                playerData = data;
                updatePlayerDropdown(); // 資料載入後更新球員下拉選單
            })
            .catch(error => {
                console.error('Failed to load player data:', error);
                // 在網頁上顯示錯誤訊息給使用者 (可選)
                // 例如： document.getElementById('error-message').textContent = '球員資料載入失敗，請稍後重試。';
            });
    }
    </script>

</body>
</html>
